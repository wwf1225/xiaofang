webpackJsonp([40],{JWXc:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("mvHQ"),n=t.n(i),r=t("IcnI"),s=t("PJh5"),o=t.n(s),l={name:"BaseFacilitySub",data:function(){return{advanced:!1,form:this.$form.createForm(this),dataSource:[],params:{facilityNo:"",facilityLocation:"",facilityName:"",patrolPeriod:"",createId:"",modifyId:"",periodId:void 0,maintainId:void 0,baseFacilitySub:[]},rule:{facilityNo:{rules:[{required:!0,message:"请输入设施编号"},{max:30,message:"长度不能超过30"}]},facilityLocation:{rules:[{required:!0,message:"请输入设施位置"}]},facilityName:{rules:[{required:!0,message:"请输入设施名称"},{max:20,message:"长度不能超过20"}]},patrolPeriod:{rules:[{required:!0,message:"请输入巡检周期"}]},periodId:{rules:[{required:!0,message:"请选择巡检人"}]},maintainId:{rules:[{required:!0,message:"请选择维修人"}]}},loading:!1,flag:"",userList:[],equipmentList:[]}},computed:{columns:function(){return[{title:"序号",width:80,customRender:function(a,e,t){return""+(t+1)},align:"center"},{title:"设备名称",dataIndex:"equipmentName",scopedSlots:{customRender:"equipmentName"},width:200,align:"center"},{title:"设备编号",dataIndex:"equipmentNo",scopedSlots:{customRender:"equipmentNo"},width:300,align:"center"},{title:"生产/维修日期",dataIndex:"startTime",scopedSlots:{customRender:"startTime"},width:300,align:"center"},{title:"到期日",dataIndex:"endTime",scopedSlots:{customRender:"endTime"},width:300,align:"center"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:200,align:"center"}]}},mounted:function(){if(this.flag=this.$route.query.flag,this.getUserList(),this.getEquipmentList(),"1"===this.flag&&this.addRow(),"2"===this.flag){var a=JSON.parse(this.$route.query.data);this.params.id=a.id,this.params.facilityNo=a.facilityNo,this.params.facilityLocation=a.facilityLocation,this.params.facilityName=a.facilityName,this.params.patrolPeriod=a.patrolPeriod,this.params.maintainId=a.maintainId,this.params.periodId=a.periodId,a.baseFacilitySub.forEach(function(e,t){a.baseFacilitySub[t].startTime=o()(e.startTime,"YYYY-MM-DD"),a.baseFacilitySub[t].endTime=o()(e.endTime,"YYYY-MM-DD")}),this.form.setFieldsValue({facilityNo:a.facilityNo,facilityLocation:a.facilityLocation,facilityName:a.facilityName,patrolPeriod:a.patrolPeriod,periodId:a.periodId,maintainId:a.maintainId}),this.dataSource=a.baseFacilitySub}},methods:{startPicker:function(a,e){null===a&&(this.dataSource[e].startTime=null)},endPicker:function(a,e){null===a&&(this.dataSource[e].endTime=null)},getEquipmentList:function(){var a=this;this.loading=!0,this.$get("/base/equipment/findEquipmentName").then(function(e){200===e.data.code&&(a.equipmentList=e.data.data),a.loading=!1}).catch(function(){a.loading=!1})},getUserList:function(){var a=this;this.loading=!0,this.$get("/user/getUserNameList").then(function(e){200===e.data.code&&(a.userList=e.data.data),a.loading=!1}).catch(function(){a.loading=!1})},delRow:function(a){this.dataSource.splice(a,1)},addRow:function(){this.dataSource.push({equipmentName:void 0,equipmentNo:"",startTime:"",endTime:""})},btnSave:function(){var a=this;this.loading=!0,this.form.validateFields(function(e,t){if(!e){var i=[],s=[],o=[],l=[];if(a.dataSource.forEach(function(e,t){""!==e.equipmentName&&""!==e.equipmentNo&&""!==e.startTime&&""!==e.endTime&&null!==e.startTime&&null!==e.endTime&&i.push(e),""!==e.equipmentName&&""!==e.equipmentNo&&""!==e.startTime&&""!==e.endTime&&null!==e.startTime&&null!==e.endTime||(l.push(t),a.$message.warning("请填写完整第("+(t+1)+")行内容")),e.startTime>=e.endTime&&(l.push(t),a.$message.warning("生产日期不能大于到期日,错误出现在第("+(t+1)+")行")),s.push(e.equipmentNo)}),l.length>0)return a.loading=!1;if(0===i.length||i===[])return a.loading=!1,a.$message.warning("请至少添加一条检查项内容");if(s.forEach(function(e){s.indexOf(e)!==s.lastIndexOf(e)&&-1===o.indexOf(e)&&(o.push(e),a.$message.warning("出现重复编号,编号为:"+e))}),o.length>0)return a.loading=!1;a.params.baseFacilitySub=i,"1"===a.flag&&(a.params.createId=r.a.state.account.user.userId,a.$axios("/base/facility/addBaseFacility",n()(a.params)).then(function(e){200===e.data.code?(a.$message.success(e.data.msg),a.$router.push({path:"/base/baseFacility",query:{flag:"1"}})):a.$message.error(e.data.msg),a.loading=!1}).catch(function(){a.loading=!1})),"2"===a.flag&&(a.params.modifyId=r.a.state.account.user.userId,a.$axios("/base/facility/updateBaseFacility",n()(a.params)).then(function(e){200===e.data.code?(a.$message.success(e.data.msg),a.$router.push({path:"/base/baseFacility",query:{flag:"2"}})):a.$message.error(e.data.msg),a.loading=!1}).catch(function(){a.loading=!1}))}a.loading=!1})},btnCancel:function(){this.$router.push({path:"/base/baseFacility"})}}},c={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[t("div",{class:a.advanced?"search":null},[t("a-form",{attrs:{layout:"horizontal",form:a.form}},[t("a-row",{staticStyle:{"margin-top":"20px"}},[t("div",{class:a.advanced?null:"fold"},[t("a-col",{attrs:{span:8,offset:2}},[t("a-form-item",{attrs:{label:"设施编号",labelCol:{span:5},wrapperCol:{span:14}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["facilityNo",a.rule.facilityNo],expression:"[ 'facilityNo', rule.facilityNo]"}],model:{value:a.params.facilityNo,callback:function(e){a.$set(a.params,"facilityNo",e)},expression:"params.facilityNo"}})],1)],1),a._v(" "),t("a-col",{attrs:{span:8,offset:4}},[t("a-form-item",{attrs:{label:"设施位置",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["facilityLocation",a.rule.facilityLocation],expression:"[ 'facilityLocation', rule.facilityLocation]"}],model:{value:a.params.facilityLocation,callback:function(e){a.$set(a.params,"facilityLocation",e)},expression:"params.facilityLocation"}})],1)],1)],1)]),a._v(" "),t("a-row",[t("div",{class:a.advanced?null:"fold"},[t("a-col",{attrs:{span:8,offset:2}},[t("a-form-item",{attrs:{label:"设施名称",labelCol:{span:5},wrapperCol:{span:14}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["facilityName",a.rule.facilityName],expression:"[ 'facilityName', rule.facilityName]"}],model:{value:a.params.facilityName,callback:function(e){a.$set(a.params,"facilityName",e)},expression:"params.facilityName"}})],1)],1),a._v(" "),t("a-col",{attrs:{span:8,offset:4}},[t("a-form-item",{attrs:{label:"巡检周期(天)",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["patrolPeriod",a.rule.patrolPeriod],expression:"[ 'patrolPeriod', rule.patrolPeriod]"}],model:{value:a.params.patrolPeriod,callback:function(e){a.$set(a.params,"patrolPeriod",e)},expression:"params.patrolPeriod"}})],1)],1)],1)]),a._v(" "),t("a-row",[t("div",{class:a.advanced?null:"fold"},[t("a-col",{attrs:{span:8,offset:2}},[t("a-form-item",{attrs:{label:"巡检人",labelCol:{span:5},wrapperCol:{span:14}}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["periodId",a.rule.periodId],expression:"[ 'periodId', rule.periodId]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default"},model:{value:a.params.periodId,callback:function(e){a.$set(a.params,"periodId",e)},expression:"params.periodId"}},a._l(a.userList,function(e){return t("a-select-option",{key:e.userId,attrs:{value:e.userId}},[a._v("\n                                    "+a._s(e.username)+"\n                                ")])}))],1)],1),a._v(" "),t("a-col",{attrs:{span:8,offset:4}},[t("a-form-item",{attrs:{label:"维修人",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["maintainId",a.rule.maintainId],expression:"[ 'maintainId', rule.maintainId]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default"},model:{value:a.params.maintainId,callback:function(e){a.$set(a.params,"maintainId",e)},expression:"params.maintainId"}},a._l(a.userList,function(e){return t("a-select-option",{key:e.userId,attrs:{value:e.userId}},[a._v("\n                                    "+a._s(e.username)+"\n                                ")])}))],1)],1)],1)])],1)],1),a._v(" "),t("div",[t("a-row",{staticClass:"operator"},[t("a-col",{attrs:{span:20,offset:2}},[t("a-button",{on:{click:a.addRow}},[a._v("添加")])],1)],1)],1),a._v(" "),t("div",[t("a-row",[t("a-col",{attrs:{span:20,offset:2}},[t("a-table",{attrs:{columns:a.columns,dataSource:a.dataSource,pagination:!1,loading:a.loading,bordered:""},scopedSlots:a._u([{key:"equipmentName",fn:function(e,i){return[t("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default"},model:{value:i.equipmentId,callback:function(e){a.$set(i,"equipmentId",e)},expression:"record.equipmentId"}},a._l(a.equipmentList,function(e){return t("a-select-option",{key:e.id,attrs:{value:e.id}},[a._v(a._s(e.equipmentName)+"\n                            ")])}))]}},{key:"equipmentNo",fn:function(e,i){return[t("a-input",{model:{value:i.equipmentNo,callback:function(e){a.$set(i,"equipmentNo",e)},expression:"record.equipmentNo"}})]}},{key:"startTime",fn:function(e,i,n){return[t("a-date-picker",{on:{change:function(e){a.startPicker(i.startTime,n)}},model:{value:i.startTime,callback:function(e){a.$set(i,"startTime",e)},expression:"record.startTime"}})]}},{key:"endTime",fn:function(e,i,n){return[t("a-date-picker",{on:{change:function(e){a.endPicker(i.endTime,n)}},model:{value:i.endTime,callback:function(e){a.$set(i,"endTime",e)},expression:"record.endTime"}})]}},{key:"operation",fn:function(e,i,n){return[t("a",{on:{click:function(e){a.delRow(n)}}},[a._v("刪除")])]}}])})],1)],1),a._v(" "),t("br"),a._v(" "),t("a-row",{staticStyle:{"margin-top":"10px"}},[t("a-col",{staticStyle:{"text-align":"center"},attrs:{span:20,offset:2}},[t("a-button",{on:{click:a.btnCancel}},[a._v("取消")]),a._v(" "),t("span",{staticStyle:{margin:"0px 10px"}}),a._v(" "),t("a-button",{on:{click:a.btnSave}},[a._v("提交")])],1)],1)],1)])},staticRenderFns:[]},d=t("VU/8")(l,c,!1,function(a){t("uzJp")},"data-v-033cdb6a",null);e.default=d.exports},uzJp:function(a,e){}});