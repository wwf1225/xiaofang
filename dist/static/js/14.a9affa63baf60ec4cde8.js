webpackJsonp([14],{XnEb:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("Dd8w"),s=e.n(i),l=(e("PJh5"),e("IcnI")),r={name:"BizInspectionTaskSub",data:function(){return{advanced:!1,form:this.$form.createForm(this),dataSource:[],loading:!1,params:{id:"",facilityId:void 0,facilityLocation:"",facilityName:"",patrolId:void 0,patrolDate:void 0,createId:"",modifyId:""},rule:{facilityId:{rules:[{required:!0,message:"请选择设施编号"}]},patrolDate:{rules:[{required:!0,message:"请选择计划巡检日期"}]},patrolId:{rules:[{required:!0,message:"请选择巡检人"}]}},facilityNoList:[],facilityIdTask:[],userList:[],flag:""}},computed:{columns:function(){return[{title:"序号",width:80,customRender:function(a,t,e){return""+(e+1)},align:"center"},{title:"设备名称",dataIndex:"equipmentName",width:200,align:"center"},{title:"设备编号",dataIndex:"equipmentNo",width:300,align:"center"},{title:"生产/维修日期",dataIndex:"startTime",width:300,align:"center"},{title:"到期日",dataIndex:"endTime",width:300,align:"center"}]}},mounted:function(){if(this.flag=this.$route.query.flag,this.getFacilityNoList(),this.getUserList(),this.findTaskFacilityList(),"2"===this.flag){var a=JSON.parse(this.$route.query.data);this.params.id=a.id,this.params.facilityId=a.facilityId,this.params.facilityLocation=a.facilityLocation,this.params.facilityName=a.facilityName,this.params.patrolDate=a.patrolDate.toString(),this.params.patrolId=a.patrolId,this.dataSource=a.baseFacilitySub,this.form.setFieldsValue({facilityId:a.facilityId,patrolDate:this.params.patrolDate,patrolId:a.patrolId})}},methods:{disabledSelect:function(a){if("2"===this.flag){var t=this.facilityIdTask.indexOf(this.$route.query.data.facilityId);-1!==t&&this.facilityIdTask.splice(t,1)}return-1!==this.facilityIdTask.indexOf(a)},findTaskFacilityList:function(){var a=this;this.$get("/business/inspection-task/findTaskFacilityList").then(function(t){200===t.data.code&&(a.facilityIdTask=t.data.data)})},getFacilityNoList:function(){var a=this;this.loading=!0,this.$get("/base/facility/findBaseFacilityList").then(function(t){200===t.data.code&&(a.facilityNoList=t.data.data),a.loading=!1}).catch(function(t){a.loading=!1})},getUserList:function(){var a=this;this.loading=!0,this.$get("/user/getUserNameList").then(function(t){200===t.data.code&&(a.userList=t.data.data),a.loading=!1}).catch(function(){a.loading=!1})},loadFacilityData:function(){var a=this;this.loading=!0,this.$get("/base/facility-sub/findBaseFacilitySub/"+this.params.facilityId).then(function(t){200===t.data.code?(a.params.facilityLocation=t.data.data.facilityLocation,a.params.facilityName=t.data.data.facilityName,a.dataSource=t.data.data.baseFacilitySub):a.$message.warning(t.data.msg),a.loading=!1}).catch(function(){a.loading=!1})},btnCancel:function(){this.$router.push({path:"/business/bizInspectionTask"})},btnSave:function(){var a=this;this.loading=!0,this.form.validateFields(function(t,e){t||("1"===a.flag&&(a.params.createId=l.a.state.account.user.userId,a.$axios("/business/inspection-task/addInspectionTask",s()({},a.params)).then(function(t){200===t.data.code?(a.$message.success(t.data.msg),a.$router.push({path:"/business/bizInspectionTask",query:{flag:"2"}})):a.$message.error(t.data.msg),a.loading=!1}).catch(function(){a.loading=!1})),"2"===a.flag&&(a.params.modifyId=l.a.state.account.user.userId,a.$axios("/business/inspection-task/updateInspectionTask",a.params).then(function(t){200===t.data.code?(a.$message.success(t.data.msg),a.$router.push({path:"/business/bizInspectionTask",query:{flag:"2"}})):a.$message.error(t.data.msg),a.loading=!1}).catch(function(){a.loading=!1}))),a.loading=!1})}}},o={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[e("div",{class:a.advanced?"search":null},[e("a-form",{attrs:{layout:"horizontal",form:a.form}},[e("a-row",[e("div",{class:a.advanced?null:"fold"},[e("a-col",{attrs:{span:8,offset:"2"}},[e("a-form-item",{attrs:{label:"设施编号",labelCol:{span:5},wrapperCol:{span:14}}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default"},on:{change:a.loadFacilityData},model:{value:a.params.facilityId,callback:function(t){a.$set(a.params,"facilityId",t)},expression:"params.facilityId"}},a._l(a.facilityNoList,function(t){return e("a-select-option",{key:t.id,attrs:{disabled:a.disabledSelect(t.id),value:t.id}},[a._v(a._s(t.facilityNo)+"\n                                ")])}))],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:"4"}},[e("a-form-item",{attrs:{label:"设施位置",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-input",{attrs:{disabled:""},model:{value:a.params.facilityLocation,callback:function(t){a.$set(a.params,"facilityLocation",t)},expression:"params.facilityLocation"}})],1)],1)],1)]),a._v(" "),e("a-row",[e("a-col",{attrs:{span:8,offset:"2"}},[e("a-form-item",{attrs:{label:"设施名称",labelCol:{span:5},wrapperCol:{span:14}}},[e("a-input",{attrs:{disabled:""},model:{value:a.params.facilityName,callback:function(t){a.$set(a.params,"facilityName",t)},expression:"params.facilityName"}})],1)],1)],1),a._v(" "),e("a-row",[e("a-col",{attrs:{span:20,offset:"2"}},[e("a-form-item",{attrs:{label:"包含设备",labelCol:{span:2},wrapperCol:{span:22}}},[e("a-table",{attrs:{columns:a.columns,dataSource:a.dataSource,pagination:!1,loading:a.loading,bordered:""},scopedSlots:a._u([{key:"operation",fn:function(t,i,s){return[e("a",{on:{click:function(t){a.delRow(s)}}},[a._v("刪除")])]}}])})],1)],1)],1),a._v(" "),e("br"),a._v(" "),e("div",[e("a-row",[e("a-col",{attrs:{span:8,offset:"2"}},[e("a-form-item",{attrs:{label:"计划巡检日期",labelCol:{span:10},wrapperCol:{span:14}}},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["patrolDate",a.rule.patrolDate],expression:"['patrolDate', rule.patrolDate]"}],staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD"},model:{value:a.params.patrolDate,callback:function(t){a.$set(a.params,"patrolDate",t)},expression:"params.patrolDate"}})],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:"4"}},[e("a-form-item",{attrs:{label:"巡检人",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["patrolId",a.rule.patrolId],expression:"['patrolId', rule.patrolId]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:a.params.patrolId,callback:function(t){a.$set(a.params,"patrolId",t)},expression:"params.patrolId"}},a._l(a.userList,function(t){return e("a-select-option",{key:t.userId,attrs:{value:t.userId}},[a._v("\n                                    "+a._s(t.username)+"\n                                ")])}))],1)],1)],1)],1),a._v(" "),e("br"),a._v(" "),e("div",[e("a-row",{staticStyle:{"text-align":"center"}},[e("a-button",{on:{click:a.btnCancel}},[a._v("返回")]),a._v(" "),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:a.btnSave}},[a._v("提交")])],1)],1)],1)],1)])},staticRenderFns:[]},n=e("VU/8")(r,o,!1,function(a){e("kd4w")},null,null);t.default=n.exports},kd4w:function(a,t){}});