webpackJsonp([39],{CpY5:function(a,t){},ioO1:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("mvHQ"),s=e.n(i),n=e("Dd8w"),r=e.n(n),o=e("PJh5"),l=e.n(o),d=e("IcnI"),c={name:"BizRepairRecordsub",data:function(){return{advanced:!1,form:this.$form.createForm(this),dataSource:[],params:{id:"",createId:"",modifyId:"",facilityId:void 0,facilityLocation:"",facilitySubId:void 0,equipmentNo:"",equipmentName:"",statusId:void 0,repairDate:"",disposeDate:void 0,remark:"",repairReason:""},flag:"",statusIdList:[],baseEquipmentSub:[],facilityNoList:[],selectedRowKeys:[],newSelectedRowKeys:[],facilityIds:[],facilitySubIds:[],loading:!1}},computed:{columns:function(){return[{title:"序号",width:80,customRender:function(a,t,e){return""+(e+1)},align:"center"},{title:"报修内容",dataIndex:"checkItem",width:300,align:"center"}]}},created:function(){if(this.flag=this.$route.query.flag,this.getFacilityNoList(),this.getstatusIdList(),this.findRepairEquipmentList(),"1"===this.flag&&(this.params.repairDate=l()(new Date).add("year",0).format("YYYY-MM-DD"),this.form.setFieldsValue({repairDate:this.params.repairDate})),"2"===this.flag){var a=JSON.parse(this.$route.query.data);this.newSelectedRowKeys=this.selectedRowKeys,this.params.id=a.id,this.params.facilityId=a.facilityId,this.params.facilitySubId=a.facilitySubId,void 0!==a.disposeDate&&(this.params.disposeDate=l()(a.disposeDate,"YYYY-MM-DD"),this.form.setFieldsValue({disposeDate:this.params.disposeDate}));var t={facilitySubId:a.facilitySubId,equipmentId:a.equipmentId,equipmentName:a.equipmentName,equipmentNo:a.equipmentNo};this.baseEquipmentSub.push(t),this.params.remark=a.remark,this.params.repairDate=a.repairDate,this.params.statusId=a.statusId,this.params.equipmentName=a.equipmentName,this.params.facilityLocation=a.facilityLocation,this.contentSearch(a.equipmentId,a.repairRecord)}},methods:{onSelectChange:function(a){this.selectedRowKeys=a},disabledSelect1:function(a){if("2"===this.flag){var t=this.facilityIds.indexOf(this.$route.query.data.facilityId);-1!==t&&this.facilityIds.splice(t,1)}return-1!==this.facilityIds.indexOf(a)},disabledSelect2:function(a){if("2"===this.flag){var t=this.facilitySubIds.indexOf(this.$route.query.data.facilitySubId);-1!==t&&this.facilitySubIds.splice(t,1)}return-1!==this.facilitySubIds.indexOf(a)},findRepairEquipmentList:function(){var a=this;this.$get("/business/repair-record/findRepairEquipmentList").then(function(t){if(200===t.data.code){var e=t.data.data;a.facilityIds=e.facilityIds,a.facilitySubIds=e.facilitySubIds}})},getstatusIdList:function(){var a=this;this.loading=!0;this.$post("/dict/findDictByTableNameAndFieldName",r()({},{tableName:"biz_repair_record",fieldName:"status"})).then(function(t){200===t.data.code&&(a.statusIdList=t.data.data,"1"===a.flag&&(a.params.statusId=a.statusIdList[0].dictId)),a.loading=!1}).catch(function(t){a.loading=!1})},getFacilityNoList:function(){var a=this;this.loading=!0,this.$get("/base/facility/findBaseFacilityList").then(function(t){200===t.data.code&&(a.facilityNoList=t.data.data),a.loading=!1}).catch(function(t){a.loading=!1})},loadFacilityData:function(a){var t=this;this.loading=!0,this.selectedRowKeys=[],this.params.facilityId=a,this.statusId=this.statusIdList[0].dictId,this.$get("/base/facility-sub/findBaseFacilitySub/"+this.params.facilityId).then(function(a){if(200===a.data.code){t.params.facilityLocation=a.data.data.facilityLocation,t.baseEquipmentSub=[];var e=[];a.data.data.baseFacilitySub.forEach(function(a){var t={facilitySubId:a.id,equipmentId:a.equipmentId,equipmentName:a.equipmentName,equipmentNo:a.equipmentNo};e.push(t)}),t.baseEquipmentSub=e,t.params.facilitySubId=void 0,t.params.equipmentName=""}else t.$message.warning(a.data.msg);t.loading=!1}).catch(function(){t.loading=!1})},getEquipmentNo:function(a){var t=this;this.params.facilitySubId=a,this.baseEquipmentSub.forEach(function(a){a.facilitySubId===t.params.facilitySubId&&(t.params.equipmentName=a.equipmentName,t.contentSearch(a.equipmentId))})},btnCancel:function(){this.$router.push("/business/bizRepairRecord")},contentSearch:function(a,t){var e=this;if(this.loading=!0,this.dataSource=[],""===a||void 0===a)return this.loading=!1,this.$message.warning("equipmentId为null");this.$get("/base/equipment-sub/findBaseEquipmentSub/"+a).then(function(a){200===a.data.code&&(e.dataSource=a.data.data.baseEquipmentSub,0!==t.length&&""!==t&&e.dataSource.forEach(function(a,i){t.forEach(function(t){a.id===t.equipmentSubid&&e.selectedRowKeys.push(i)})})),e.loading=!1}).catch(function(){e.loading=!1})},btnSave:function(){var a=this;this.loading=!0,this.form.validateFields(function(t,e){if(!t){if(""===a.params.facilityId||void 0===a.params.facilityId)return a.loading=!1,a.$message.warning("请选择设施编号！");if(""===a.params.facilitySubId||void 0===a.params.facilitySubId)return a.loading=!1,a.$message.warning("请选择设备编号！");if(new Date(a.params.repairDate).getTime()>new Date(a.params.disposeDate).getTime())return a.loading=!1,a.$message.warning("报修日期不能大于处理日期！");if(36===a.params.statusId&&(void 0===a.params.disposeDate||""===a.params.disposeDate))return a.loading=!1,a.$message.warning("请选择处理日期！");if(0===a.selectedRowKeys.length||a.selectedRowKeys===[])return a.loading=!1,a.$message.warning("请选择报修原因！");var i=d.a.state.account.user.userId,n=[];a.dataSource.forEach(function(t,e){-1!==a.selectedRowKeys.indexOf(e)?n.push(1):n.push(0)}),a.params.repairReason=parseInt(n.reverse().join(""),2),"1"===a.flag&&(a.params.createId=i,a.$axios("/business/repair-record/addRepairRecord",s()(a.params)).then(function(t){200===t.data.code?(a.$message.success(t.data.msg),a.$router.push({path:"/business/bizRepairRecord",query:{flag:"1"}})):a.$message.warning(t.data.msg),a.loading=!1}).catch(function(){a.loading=!1})),"2"===a.flag&&(a.params.modifyId=i,a.$axios("/business/repair-record/updateRepairRecord",s()(a.params)).then(function(t){200===t.data.code?(a.$message.success(t.data.msg),a.$router.push({path:"/business/bizRepairRecord",query:{flag:"2"}})):a.$message.warning(t.data.msg),a.loading=!1}).catch(function(){a.loading=!1}))}a.loading=!1})}}},u={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("a-card",{staticClass:"card-area",attrs:{bordered:!1}},[e("div",{class:a.advanced?"search":null},[e("a-form",{attrs:{layout:"horizontal",form:a.form}},[e("a-row",[e("a-col",{attrs:{span:8,offset:2}},[e("a-form-item",{attrs:{label:"设施编号",labelCol:{span:6},wrapperCol:{span:14}}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default",disabled:"2"===a.flag},on:{change:a.loadFacilityData},model:{value:a.params.facilityId,callback:function(t){a.$set(a.params,"facilityId",t)},expression:"params.facilityId"}},a._l(a.facilityNoList,function(t){return e("a-select-option",{key:t.id,attrs:{disabled:a.disabledSelect1(t.id),value:t.id}},[a._v(a._s(t.facilityNo)+"\n                            ")])}))],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:4}},[e("a-form-item",{attrs:{label:"设施位置",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-input",{attrs:{disabled:""},model:{value:a.params.facilityLocation,callback:function(t){a.$set(a.params,"facilityLocation",t)},expression:"params.facilityLocation"}})],1)],1)],1),a._v(" "),e("a-row",[e("a-col",{attrs:{span:8,offset:2}},[e("a-form-item",{attrs:{label:"设备编号",labelCol:{span:6},wrapperCol:{span:14}}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"default",disabled:void 0===a.params.facilityId||"2"===a.flag},on:{change:a.getEquipmentNo},model:{value:a.params.facilitySubId,callback:function(t){a.$set(a.params,"facilitySubId",t)},expression:"params.facilitySubId"}},a._l(a.baseEquipmentSub,function(t){return e("a-select-option",{key:t.facilitySubId,attrs:{disabled:a.disabledSelect2(t.facilitySubId),value:t.facilitySubId}},[a._v("\n                                "+a._s(t.equipmentNo)+"\n                            ")])}))],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:4}},[e("a-form-item",{attrs:{label:"设备名称",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-input",{attrs:{disabled:""},model:{value:a.params.equipmentName,callback:function(t){a.$set(a.params,"equipmentName",t)},expression:"params.equipmentName"}})],1)],1)],1),a._v(" "),e("a-row",[e("a-col",{attrs:{span:8,offset:2}},[e("a-form-item",{attrs:{label:"报修日期",labelCol:{span:6},wrapperCol:{span:14}}},[e("a-input",{attrs:{disabled:""},model:{value:a.params.repairDate,callback:function(t){a.$set(a.params,"repairDate",t)},expression:"params.repairDate"}})],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:4}},[e("a-form-item",{attrs:{label:"处理日期",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-date-picker",{staticStyle:{width:"100%"},model:{value:a.params.disposeDate,callback:function(t){a.$set(a.params,"disposeDate",t)},expression:"params.disposeDate"}})],1)],1)],1),a._v(" "),e("a-row",[e("a-col",{attrs:{span:8,offset:2}},[e("a-form-item",{attrs:{label:"处理状态",labelCol:{span:6},wrapperCol:{span:14}}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:"1"===a.flag||36===a.params.statusId},model:{value:a.params.statusId,callback:function(t){a.$set(a.params,"statusId",t)},expression:"params.statusId"}},a._l(a.statusIdList,function(t){return e("a-select-option",{key:t.dictId,attrs:{value:t.dictId}},[a._v("\n                                "+a._s(t.valuee)+"\n                            ")])}))],1)],1),a._v(" "),e("a-col",{attrs:{span:8,offset:4}},[e("a-form-item",{attrs:{label:"备注",labelCol:{span:6,offset:4},wrapperCol:{span:14}}},[e("a-textarea",{attrs:{rows:3},model:{value:a.params.remark,callback:function(t){a.$set(a.params,"remark",t)},expression:"params.remark"}})],1)],1)],1),a._v(" "),e("a-row",[e("a-col",{attrs:{span:20,offset:2}},[e("a-form-item",{attrs:{label:"报修原因",labelCol:{span:2},wrapperCol:{span:22}}},[e("a-table",{attrs:{columns:a.columns,dataSource:a.dataSource,pagination:!1,rowSelection:{selectedRowKeys:a.selectedRowKeys,onChange:a.onSelectChange},loading:a.loading,bordered:""}})],1)],1)],1),a._v(" "),e("br"),a._v(" "),e("a-row",[e("a-col",{staticStyle:{"text-align":"center"}},[e("a-button",{on:{click:a.btnCancel}},[a._v("返回")]),a._v(" "),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:a.btnSave}},[a._v("提交")])],1)],1)],1)],1)])},staticRenderFns:[]},p=e("VU/8")(c,u,!1,function(a){e("CpY5")},"data-v-11990dce",null);t.default=p.exports}});